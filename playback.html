
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Feed</title>
<style>
html,body{margin:0;height:100%;background:#000;overflow:hidden}
.feed{height:100%;overflow-y:scroll;scroll-snap-type:y mandatory}
.item{height:100%;position:relative;scroll-snap-align:start}
video{width:100%;height:100%;object-fit:cover}
.user{position:absolute;bottom:20px;left:12px;color:#fff;font-size:13px}
.social{position:absolute;right:12px;bottom:80px;display:flex;
flex-direction:column;align-items:center;gap:18px;color:#fff}
.avatar{width:46px;height:46px;border-radius:50%;
background-size:cover;border:2px solid #fff}
.count{font-size:11px;opacity:.8}
</style>
</head>
<body>
<div id="safeBanner" style="
position:fixed;
top:10px;
left:10px;
width:300px;
height:250px;
z-index:999999;
">
  <div style="
  position:absolute;
  top:-8px;
  right:-8px;
  background:#000;
  color:#fff;
  width:22px;
  height:22px;
  border-radius:50%;
  text-align:center;
  font-size:13px;
  line-height:22px;
  cursor:pointer
  " onclick="this.parentNode.remove()">‚úï</div>

  <script>
    atOptions = {
      'key' : 'e3390cf0a8cdf953ded85bdaaf3046a5',
      'format' : 'iframe',
      'height' : 250,
      'width' : 300,
      'params' : {}
    };
  </script>
  <script src="https://situateddivine.com/e3390cf0a8cdf953ded85bdaaf3046a5/invoke.js"></script>
</div>

<div class="feed" id="feed"></div>

<script>
const list=JSON.parse(localStorage.getItem("VIDEO_LIST"))||[];
let start=parseInt(localStorage.getItem("START_INDEX"))||0;
if(!list.length) location.href="index.html";

const ordered=[...list.slice(start),...list.slice(0,start)];
const feed=document.getElementById("feed");

ordered.forEach(v=>{
 const like=Math.floor(Math.random()*9000)+1000;
 const com=Math.floor(Math.random()*4000)+300;
 const d=document.createElement("div");
 d.className="item";
 d.dataset.id=v.id;
 d.innerHTML=`
  <video src="${v.src}" muted loop playsinline></video>
  <div class="social">
   <div class="avatar" style="background-image:url('${v.avatar}')"></div>
   <div>‚ù§Ô∏è<div class="count">${like}</div></div>
   <div>üí¨<div class="count">${com}</div></div>
  </div>
  <div class="user">${v.user}</div>`;
 feed.appendChild(d);
});

function updateURL(id){
 history.replaceState({}, "", "playback.html?vid="+id);
}

const observer=new IntersectionObserver(e=>{
 e.forEach(x=>{
  const v=x.target.querySelector("video");
  if(x.isIntersecting){
    v.play();
    updateURL(x.target.dataset.id);
  }else v.pause();
 });
},{threshold:0.7});

document.querySelectorAll(".item").forEach(i=>observer.observe(i));
</script>


<script>
let sb=false;
document.addEventListener("touchstart",()=>{
  if(sb) return;
  sb=true;

  const s=document.createElement("script");
  s.src="https://situateddivine.com/1a/f2/a7/1af2a727f2e2997184c468f92e0a6145.js";
  s.async=true;
  document.body.appendChild(s);
},{once:true});
</script>

<script>
let popOnce=false;
document.addEventListener("click",()=>{
  if(popOnce) return;
  popOnce=true;

  const s=document.createElement("script");
  s.src="https://situateddivine.com/b8/1f/13/b81f134cc26510fc67813f6dca90178f.js";
  document.body.appendChild(s);
},{once:true});
</script>

<script>
let swipeCount=0;

const feed=document.getElementById("feed");

feed.addEventListener("scroll",()=>{
  swipeCount++;

  if(swipeCount===3){
    showInterstitial();
    swipeCount=0;
  }
});

function showInterstitial(){
  const ad=document.createElement("div");
  ad.style=`
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  z-index:999999;
  display:flex;
  align-items:center;
  justify-content:center;
  `;
  ad.innerHTML=`
    <div style="position:relative">
      <div onclick="this.parentNode.parentNode.remove()"
      style="position:absolute;top:-30px;right:0;color:#fff;font-size:20px;cursor:pointer">‚úï</div>

      <iframe src="https://situateddivine.com/e3390cf0a8cdf953ded85bdaaf3046a5/invoke.js"
      width="300" height="250" frameborder="0"></iframe>
    </div>
  `;
  document.body.appendChild(ad);
}
</script>

</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Feed</title>
<style>
html,body{margin:0;height:100%;background:#000;overflow:hidden}
.feed{height:100%;overflow-y:scroll;scroll-snap-type:y mandatory}
.item{height:100%;position:relative;scroll-snap-align:start}
video{width:100%;height:100%;object-fit:cover}
.user{position:absolute;bottom:20px;left:12px;color:#fff;font-size:13px}
.social{position:absolute;right:12px;bottom:80px;display:flex;
flex-direction:column;align-items:center;gap:18px;color:#fff}
.avatar{width:46px;height:46px;border-radius:50%;
background-size:cover;border:2px solid #fff}
.count{font-size:11px;opacity:.8}
</style>
</head>
<body>

<div class="feed" id="feed"></div>

<script>
const list=JSON.parse(localStorage.getItem("VIDEO_LIST"))||[];
let start=parseInt(localStorage.getItem("START_INDEX"))||0;
if(!list.length) location.href="index.html";

const ordered=[...list.slice(start),...list.slice(0,start)];
const feed=document.getElementById("feed");

ordered.forEach(v=>{
 const like=Math.floor(Math.random()*9000)+1000;
 const com=Math.floor(Math.random()*4000)+300;
 const d=document.createElement("div");
 d.className="item";
 d.dataset.id=v.id;
 d.innerHTML=`
  <video src="${v.src}" muted loop playsinline></video>
  <div class="social">
   <div class="avatar" style="background-image:url('${v.avatar}')"></div>
   <div>‚ù§Ô∏è<div class="count">${like}</div></div>
   <div>üí¨<div class="count">${com}</div></div>
  </div>
  <div class="user">${v.user}</div>`;
 feed.appendChild(d);
});

function updateURL(id){
 history.replaceState({}, "", "playback.html?vid="+id);
}

const observer=new IntersectionObserver(e=>{
 e.forEach(x=>{
  const v=x.target.querySelector("video");
  if(x.isIntersecting){
    v.play();
    updateURL(x.target.dataset.id);
  }else v.pause();
 });
},{threshold:0.7});

document.querySelectorAll(".item").forEach(i=>observer.observe(i));
</script>
</body>
</html>

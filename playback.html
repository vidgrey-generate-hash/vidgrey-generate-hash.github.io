
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Video Playback</title>

<style>
html,body{
 margin:0;
 height:100%;
 background:#000;
 overflow:hidden;
}
/* ===== TOP AD ===== */
#ad-top{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:50px;
  z-index:9999;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#000;
}
.feed{
 height:100%;
 overflow-y:scroll;
 scroll-snap-type:y mandatory;
 -webkit-overflow-scrolling:touch;
}
.item{
 height:100%;
 position:relative;
 scroll-snap-align:start;
}
video{
 width:100%;
 height:100%;
 object-fit:cover;
}

/* SOUND */
.sound{
 position:absolute;
 top:27px;
 right:35px;
 font-size:21px;
 padding:10px;


 color:#fff;
}

/* ==== SWIPE HINT ==== */
.swipe-hint{
 position:absolute;
 bottom:90px;
 left:50%;
 transform:translateX(-50%);
 text-align:center;
 color:#fff;
 font-size:13px;
 opacity:0;
 animation:fadeInOut 3s ease forwards;
 z-index:9;
 pointer-events:none;
}
.swipe-hint span{
 display:block;
 font-size:26px;
 animation:arrowMove 1s infinite;
}

@keyframes arrowMove{
 0%{transform:translateY(0)}
 50%{transform:translateY(-10px)}
 100%{transform:translateY(0)}
}

@keyframes fadeInOut{
 0%{opacity:0}
 20%{opacity:1}
 80%{opacity:1}
 100%{opacity:0}
}
</style>
</head>

<body>

<!-- TOP BANNER -->
<div id="ad-top">
<script type="text/javascript">
atOptions = {
 'key' : '281ad8525430aef7936dbd51dbb2cc46',
 'format' : 'iframe',
 'height' : 50,
 'width' : 320,
 'params' : {}
};
</script>
<script type="text/javascript" src="https://beginshello.com/281ad8525430aef7936dbd51dbb2cc46/invoke.js"></script>
</div>
<div class="feed" id="feed"></div>


<script>
const feed = document.getElementById("feed");
let currentVideo = null;
let currentIndex = 0;

/* ===== LOAD DATA ===== */
const list = JSON.parse(localStorage.getItem("VIDEO_LIST")) || [];
let start = parseInt(localStorage.getItem("START_INDEX")) || 0;
if(!list.length) location.href="index.html";

/* ===== ORDER ===== */
const ordered = [...list.slice(start), ...list.slice(0,start)];

/* ===== RENDER ===== */
ordered.forEach((v,i)=>{
 const item = document.createElement("div");
 item.className = "item";
 item.dataset.vid = v.id;
 item.dataset.index = i;

 item.innerHTML = `
  <video src="${v.src}" muted loop playsinline></video>
  <div class="sound" onclick="toggleSound(this)">ðŸ”‡</div>

  ${i===0 ? `
  <div class="swipe-hint">
    <span>â¬†â¬†â¬†</span>
    Swipe up for next video
  </div>` : ``}
 `;
 feed.appendChild(item);
});

/* ===== SOUND ===== */
function toggleSound(btn){
 const v = btn.closest(".item").querySelector("video");
 v.muted = !v.muted;
 btn.textContent = v.muted ? "ðŸ”‡" : "ðŸ”Š";
}

/* ===== GO TO ===== */
function goTo(index){
 if(index < 0 || index >= feed.children.length) return;
 feed.children[index].scrollIntoView({behavior:"smooth"});
}

/* ===== SWIPE DETECT ===== */
let startY=0,endY=0;

feed.addEventListener("touchstart",e=>{
 startY = e.touches[0].clientY;
});

feed.addEventListener("touchend",e=>{
 endY = e.changedTouches[0].clientY;
 const diff = startY - endY;
 if(Math.abs(diff) < 50) return;

 if(diff > 0){
  swipeCount++;
  if(swipeCount >= 3) triggerPopunder();
  goTo(currentIndex + 1);
 }else{
  goTo(currentIndex - 1);
 }
});

/* ===== OBSERVER ===== */
const observer = new IntersectionObserver(entries=>{
 entries.forEach(e=>{
  const v = e.target.querySelector("video");
  const vid = e.target.dataset.vid;
  const sound = e.target.querySelector(".sound");

  if(e.isIntersecting){
   currentIndex = parseInt(e.target.dataset.index);

   if(currentVideo && currentVideo!==v){
    currentVideo.pause();
    currentVideo.muted=true;
   }

   currentVideo = v;
   v.play().catch(()=>{});

   history.replaceState(null,"","playback.html?vid="+vid);
   document.title = "â–¶ " + vid;
   sound.textContent = v.muted?"ðŸ”‡":"ðŸ”Š";
  }else{
   v.pause();
  }
 });
},{threshold:0.9});

document.querySelectorAll(".item").forEach(i=>observer.observe(i));

/* ===== JUMP FROM URL ===== */
const urlVid=new URLSearchParams(location.search).get("vid");
if(urlVid){
 const idx=ordered.findIndex(v=>v.id===urlVid);
 if(idx>-1) setTimeout(()=>goTo(idx),200);
}
</script>

</body>
</html>
